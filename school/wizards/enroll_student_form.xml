<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <record model="ir.actions.act_window" id="enroll_student_form_action">
    <field name="name">Enroll Student Action</field>
    <field name="res_model">enroll.student.form</field>
    <field name="view_mode">form</field>
    <field name="target">inline</field>
  </record>
  
  <menuitem name="Enroll Student" 
    id="enroll_student_menuitem"
    action="school.enroll_student_form_action"
    parent="school.people_management"/>

  <record id="enroll_student_form" model="ir.ui.view">
    <field name="name">enroll.student.form</field>
    <field name="model">enroll.student.form</field>
    <field name="arch" type="xml">
      <form>
        <header>
          <field name="state" widget="statusbar" statusbar_visible="1,2,3"/>
        </header>
        <sheet>
          <group attrs="{'invisible': [('state', '!=', '1')]}">
            <p colspan="2"></p>
            <field name="student_ids" mode="kanban">
              <kanban>
                <field name="name"/>
                <field name="phone"/>
                <field name="id"/>
                <field name="avatar"/>
                <templates>
                  <t t-name="kanban-box">
                    <div class="oe_kanban_global_click">
                      <a type="delete" 
                        class="position-absolute" 
                        style="top: 0; right: 1rem; font-size: 20px;">
                        <span>&amp;times;</span>
                      </a>
                      <div class="o_kanban_image">
                        <img alt="Avatar" t-att-src="kanban_image('enroll.student.form.student', 'avatar', record.id.raw_value)" />
                        <!-- <img alt="Avatar" t-att-src="data:image/gif;base64,{{record.avatar.raw_value}} if " /> -->
                      </div>
                      <div class="oe_kanban_details">
                        <ul class="list-unstyled">
                          <li>
                            <strong class="o_kanban_record_title">
                              <field name="name" />
                            </strong>
                          </li>
                          <li> <field name="phone"/> </li>
                          <li> <field name="email"/> </li>
                        </ul>
                      </div>
                    </div>
                  </t>
                </templates>
              </kanban>
            </field>
          </group>
          <group attrs="{'invisible': [('state', '!=', '2')]}" >
            <h1 colspan="2">Family</h1>
            <field name="family_ids" />
            <!-- <group> -->
            <!--   <button name="add_new_family" --> 
            <!--     type="object" --> 
            <!--     colspan="1" --> 
            <!--     string="ADD NEW FAMILY"/> -->
            <!--   <button name="add_existing_family" --> 
            <!--     type="object" --> 
            <!--     colspan="1" --> 
            <!--     string="ADD EXISTING FAMILY"/> -->
            <!-- </group> -->
            <!-- <group> -->
            <!-- </group> -->
          </group>
          <group attrs="{'invisible': [('state', '!=', '3')]}" >
            <field name="family_edit_relationship_id" domain="[('id', 'in', family_ids)]"/>
            <field name="family_relationship_ids" domain="[('family_id', '=', family_edit_relationship_id)]">
              <tree editable="bottom">
                <field name="family_id" />
<!--                <field name="form_student_ids" invisible="1" />-->
                <field name="individual_id" readonly="1" />
                <field name="family_individual_ids" invisible="1" />
                <field name="individual_relation_id" readonly="1" 
                    domain="[('id', 'in', family_individual_ids)]" />
                <field name="relationship_type_id" />
                <field name="custody" />
                <field name="correspondence" />
                <field name="family_portal" />
                <field name="is_emergency_contact" />
                <field name="financial_responsability" />
              </tree>
            </field>
          </group>
          <footer class="text-right">
            <button name="move_prev_step" type="object" string="Prev" 
              attrs="{'invisible': [('state', 'in', ['1', 'done'])]}"/>
            <button name="move_next_step" type="object" string="Next" 
              attrs="{'invisible': [('state', 'in', ['3', 'done'])]}"/>
            <button name="enroll" type="object" string="Enroll" 
              attrs="{'invisible': [('state', '!=', '3')]}"/>
          </footer>
        </sheet>
      </form>
    </field>
  </record>

  <record id="enroll_student_form_student_form" model="ir.ui.view">
    <field name="name">enroll.student.form.student.form</field>
    <field name="model">enroll.student.form.student</field>
    <field name="arch" type="xml">
      <form>
        <sheet>
          <field colspan="2" nolabel="1" name="avatar" widget="image" class="oe_avatar" />
          <div class="oe_title h1">
            <field name="name" readonly="1"/>
          </div>
          <group>
            <group name="left_group">
              <field name="first_name"/>
              <field name="middle_name"/>
              <field name="last_name"/>
            </group>
            <group name="left_group">
              <field name="date_of_birth"/>
              <field name="gender"/>
              <field name="phone" />
              <field name="email" />
              <field name="email2" />
            </group>
          </group>
          <notebook>
            <page name="program_settings" string="Program" >
              <field name="program_setting_ids">
                <tree editable="bottom">
                  <field name="school_id" />
                  <field name="program_id" 
                    context="{'default_school_id': school_id}"
                    domain="[('school_id', '=', school_id)]" />
                  <field name="grade_level_id" 
                    context="{'default_program_id': program_id}"
                    domain="[('program_id', '=', program_id)]"/>
                  <field name="status_id"/>
                </tree>
              </field>
            </page>
          </notebook>
        </sheet>
      </form>
    </field>
  </record>

</odoo>
