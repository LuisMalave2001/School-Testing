<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

  <menuitem
    id="school_structure_menu"
    name="School structure"
    parent="school.school_settings_menu"
    sequence="1"/>

  <!-- District views -->
  <act_window
    id="school_districts_action"
    name="Districts"
    res_model="school.district"
    view_mode="kanban,tree,form"
  />

  <menuitem
    id="school_districts_menuitem"
    parent="school.school_structure_menu"
    name="District"
    sequence="10"
    action="school.school_districts_action"
  />

  <record id="school_district_view_search" model="ir.ui.view">
    <field name="name">school.district.view.search</field>
    <field name="model">school.district</field>
    <field name="arch" type="xml">
      <search>
        <field name="name"/>
        <field name="company_ids"/>
        <searchpanel>
          <field name="company_ids" select="multi" string="Company" icon="fa-building" color="#4682b4"/>
        </searchpanel>
      </search>
    </field>
  </record>

  <record id="school_district_view_kanban" model="ir.ui.view">
    <field name="name">school.district.view.kanban</field>
    <field name="model">school.district</field>
    <field name="arch" type="xml">
      <kanban>
        <field name="name"/>
        <templates>
          <t t-name="kanban-box">
            <div class="oe_kanban_global_click o_kanban_record_has_image_fill">
              <field name="image_128" widget="image" class="o_kanban_image_fill_left"
                     options="{'zoom': true, 'zoom_delay': 1000, 'background': true, 'preventClicks': false}"/>
              <div class="oe_kanban_details">
                <div class="o_kanban_record_top">
                  <div class="o_kanban_record_headings">
                    <div class="o_kanban_record_title">
                      <field name="name"/>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </t>
        </templates>
      </kanban>
    </field>
  </record>

  <record id="school_district_view_tree" model="ir.ui.view">
    <field name="name">school.district.view.tree</field>
    <field name="model">school.district</field>
    <field name="arch" type="xml">
      <tree>
        <field name="name"/>
      </tree>
    </field>
  </record>

  <record id="school_district_view_form" model="ir.ui.view">
    <field name="name">school.district.view.form</field>
    <field name="model">school.district</field>
    <field name="arch" type="xml">
      <form>
        <field name="id" invisible="1"/>
        <sheet>
          <field name="image_1920" widget="image" class="oe_avatar"/>
          <div class="oe_title">
            <label for="name" class="oe_edit_only"/>
            <h1>
              <field name="name"/>
            </h1>
          </div>
          <group>
            <group name="left_group">
            </group>
            <group name="right_group">
              <field name="company_ids"
                     groups="base.group_multi_company" widget="many2many_tags"/>
            </group>
          </group>
          <notebook>
            <page name="schools" string="Schools">
              <field name="school_ids" mode="kanban"
                     context="{'default_company_ids': company_ids, 'default_district_company_ids': company_ids}">
                <form>
                  <sheet>
                    <field name="image_1920" widget="image" class="oe_avatar"/>
                    <div class="oe_title">
                      <label for="name" class="oe_edit_only"/>
                      <h1>
                        <field name="name"/>
                      </h1>
                    </div>
                    <group>
                      <group>
                        <field name="district_company_ids" invisible="1"/>
                        <field name="company_ids" domain="[('id', 'in', district_company_ids)]"
                               groups="base.group_multi_company" widget="many2many_tags"/>
                      </group>
                    </group>
                    <notebook>
                      <page name="program_ids" string="Programs">
                        <field name="program_ids"/>
                      </page>
                    </notebook>
                  </sheet>
                </form>
              </field>
            </page>
          </notebook>
        </sheet>
      </form>
    </field>
  </record>

  <!-- School views -->
  <act_window
    id="school_schools_action"
    name="Schools"
    res_model="school.school"
    view_mode="kanban,tree,form"
  />

  <menuitem
    id="school_schools_menuitem"
    parent="school.school_structure_menu"
    name="School"
    sequence="20"
    action="school.school_schools_action"
  />

  <record id="school_school_view_search" model="ir.ui.view">
    <field name="name">school.school.view.search</field>
    <field name="model">school.school</field>
    <field name="arch" type="xml">
      <search>
        <field name="name"/>
        <field name="district_id"/>
        <searchpanel>
          <field name="district_id" select="multi" string="Districts" icon="fa-building" color="#4682b4"/>
        </searchpanel>
      </search>
    </field>
  </record>

  <record id="school_school_view_kanban" model="ir.ui.view">
    <field name="name">school.school.view.kanban</field>
    <field name="model">school.school</field>
    <field name="arch" type="xml">
      <kanban default_group_by="district_id">
        <field name="name"/>
        <templates>
          <t t-name="kanban-box">
            <div class="oe_kanban_global_click o_kanban_record_has_image_fill">
              <field name="image_128" widget="image" class="o_kanban_image_fill_left"
                     options="{'zoom': true, 'zoom_delay': 1000, 'background': true, 'preventClicks': false}"/>
              <div class="oe_kanban_details">
                <div class="o_kanban_record_top">
                  <div class="o_kanban_record_headings">
                    <div class="o_kanban_record_title">
                      <field name="name"/>
                    </div>
                  </div>
                </div>
                <div class="o_kanban_record_body">
                  <ul>
                    <li><field name="program_ids" widget="many2many_tags"/></li>
                  </ul>
                </div>
              </div>
            </div>
          </t>
        </templates>
      </kanban>
    </field>
  </record>

  <record id="school_school_view_tree" model="ir.ui.view">
    <field name="name">school.school.view.tree</field>
    <field name="model">school.school</field>
    <field name="arch" type="xml">
      <tree>
        <field name="name"/>
        <field name="district_id"/>
        <field name="program_ids" widget="many2many_tags"/>
      </tree>
    </field>
  </record>

  <record id="school_school_view_form" model="ir.ui.view">
    <field name="name">school.school.view.form</field>
    <field name="model">school.school</field>
    <field name="arch" type="xml">
      <form>
        <sheet>
          <field name="image_1920" widget="image" class="oe_avatar"/>
          <div class="oe_title">
            <label for="name" class="oe_edit_only"/>
            <h1>
              <field name="name"/>
            </h1>
          </div>
          <group>
            <group name="left_group">
              <field name="district_id"/>
            </group>
            <group name="right_group">
              <field name="company_ids" groups="base.group_multi_company" widget="many2many_tags"/>
            </group>
          </group>
          <notebook>
            <page name="program_ids" string="Programs">
              <field name="program_ids"/>
            </page>
          </notebook>
        </sheet>
      </form>
    </field>
  </record>

  <!-- Program views -->
  <act_window
    id="school_programs_action"
    name="Programs"
    res_model="school.program"
    view_mode="kanban,tree,form"
  />

  <menuitem
    id="school_programs_menuitem"
    parent="school.school_structure_menu"
    name="Program"
    sequence="40"
    action="school.school_programs_action"
  />

  <record id="school_program_view_search" model="ir.ui.view">
    <field name="name">school.program.view.search</field>
    <field name="model">school.program</field>
    <field name="arch" type="xml">
      <search>
        <field name="name"/>
        <field name="school_id"/>
        <field name="school_district_id"/>
        <field name="parent_id"/>

        <filter name="filter_root_parent" string="Root parent" domain="[('parent_id', '=', False)]"/>

        <searchpanel>
          <field name="school_id" select="multi" string="District/School" groupby="district_id" icon="fa-building"
                 color="#4682b4"/>
        </searchpanel>
      </search>
    </field>
  </record>

  <record id="school_program_view_kanban" model="ir.ui.view">
    <field name="name">school.program.view.kanban</field>
    <field name="model">school.program</field>
    <field name="arch" type="xml">
      <kanban default_group_by="school_id">
        <field name="name"/>
        <templates>
          <t t-name="kanban-box">
            <div class="oe_kanban_global_click o_kanban_record">
              <div class="oe_kanban_details">
                <div class="o_kanban_record_top">
                  <div class="o_kanban_record_headings">
                    <div class="o_kanban_record_title">
                      <field name="name"/>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </t>
        </templates>
      </kanban>
    </field>
  </record>

  <record id="school_program_view_tree" model="ir.ui.view">
    <field name="name">school.program.view.tree</field>
    <field name="model">school.program</field>
    <field name="arch" type="xml">
      <tree>
        <field name="display_name"/>
        <field name="child_ids" widget="many2many_tags"/>
      </tree>
    </field>
  </record>

  <record id="school_program_view_form" model="ir.ui.view">
    <field name="name">school.program.view.form</field>
    <field name="model">school.program</field>
    <field name="arch" type="xml">
      <form>
        <sheet>
          <field name="id" invisible="1"/>
          <group>
            <group name="left_group">
              <field name="name"/>
              <field name="school_id"/>
            </group>
            <group name="right_group">
              <field name="parent_id"/>
            </group>
            <group colspan="2">
              <field name="period_ids">
                <tree>
                  <field name="name"/>
                  <field name="child_ids" widget="many2many_tags"/>
                </tree>
              </field>
            </group>
          </group>
        </sheet>
      </form>
    </field>
  </record>

  <!-- Period views -->
  <act_window
    id="school_periods_action"
    name="Periods"
    res_model="school.period"
    view_mode="tree,form"
    context="{'search_default_group_by_program_id': 1}"
  />

  <menuitem
    id="school_periods_menuitem"
    parent="school.school_structure_menu"
    name="Period"
    sequence="50"
    action="school.school_periods_action"
  />

  <record id="school_period_view_search" model="ir.ui.view">
    <field name="name">school.period.view.search</field>
    <field name="model">school.period</field>
    <field name="arch" type="xml">
      <search>
        <field name="name"/>
        <field name="program_id"/>

        <filter name="group_by_program_id" string="Group by program" context="{'group_by': 'program_id'}"/>

        <searchpanel>
          <field name="program_id" select="multi" string="School/Program" groupby="school_id" icon="fa-building"
                 color="#4682b4"/>
        </searchpanel>
      </search>
    </field>
  </record>

  <record id="school_period_view_tree" model="ir.ui.view">
    <field name="name">school.period.view.tree</field>
    <field name="model">school.period</field>
    <field name="arch" type="xml">
      <tree>
        <field name="display_name"/>
        <field name="date_start"/>
        <field name="date_end"/>
        <field name="child_ids" widget="many2many_tags"/>
        <field name="program_id"/>
      </tree>
    </field>
  </record>

  <record id="school_period_view_form" model="ir.ui.view">
    <field name="name">school.period.view.form</field>
    <field name="model">school.period</field>
    <field name="arch" type="xml">
      <form>
        <sheet>
          <field name="id" invisible="1"/>
          <group>
            <group name="left_group">
              <field name="name"/>
              <field name="date_start"
                     options="{'related_end_date': 'date_end'}"
                     attrs="{'readonly': [('child_ids', '!=', [])]}"
              />
              <field name="category_id"/>
            </group>
            <group name="right_group">
              <field name="parent_id"/>
              <field name="date_end"
                     options="{'related_start_date': 'date_start'}"
                     attrs="{'readonly': [('child_ids', '!=', [])]}"/>
              <field name="program_id" force_save="1"/>
            </group>
            <group colspan="2">
              <field name="child_ids" context="{'default_parent_id': id}">
                <tree>
                  <field name="name"/>
                  <field name="date_start"/>
                  <field name="date_end"/>
                  <field name="category_id"/>
                  <field name="child_ids" widget="many2many_tags"/>
                </tree>
              </field>
            </group>
          </group>
        </sheet>
      </form>
    </field>
  </record>

  <!-- Grade views -->
  <act_window
    id="school_grades_action"
    name="Grade Levels"
    res_model="school.grade.level"
    view_mode="tree,form"
    context="{'search_default_group_by_program_id': 1}"
  />

  <menuitem
    id="school_grades_menuitem"
    parent="school.school_structure_menu"
    name="Grade levels"
    sequence="60"
    action="school.school_grades_action"
  />

  <record id="school_grade_view_search" model="ir.ui.view">
    <field name="name">school.grade.view.search</field>
    <field name="model">school.grade.level</field>
    <field name="arch" type="xml">
      <search>
        <field name="name"/>
        <field name="program_id"/>
        <field name="school_id"/>
        <field name="district_id"/>
        <field name="capacity"/>

        <filter name="group_by_program_id" string="Group by program" context="{'group_by': 'program_id'}"/>
        <filter name="group_by_school_id" string="Group by school" context="{'group_by': 'school_id'}"/>
        <filter name="group_by_district_id" string="Group by district" context="{'group_by': 'district_id'}"/>

        <searchpanel>
          <field name="program_id" select="multi" string="School/Program" groupby="school_id" icon="fa-building"
                 color="#4682b4"/>
          <field name="district_id" select="multi" icon="fa-flag" color="#4682b4"/>
        </searchpanel>
      </search>
    </field>
  </record>

  <record id="school_grade_view_tree" model="ir.ui.view">
    <field name="name">school.grade.view.tree</field>
    <field name="model">school.grade.level</field>
    <field name="arch" type="xml">
      <tree>
        <field name="name"/>
        <field name="program_id"/>
        <field name="school_id"/>
        <field name="district_id"/>
        <field name="capacity" sum="Total capacity"/>
      </tree>
    </field>
  </record>

  <record id="school_grade_view_form" model="ir.ui.view">
    <field name="name">school.grade.view.form</field>
    <field name="model">school.grade.level</field>
    <field name="arch" type="xml">
      <form>
        <sheet>
          <group>
            <group name="left_group">
              <field name="name"/>
              <field name="capacity"/>
            </group>
            <group name="right_group">
              <field name="program_id"/>
              <field name="school_id" readonly="1"/>
              <field name="district_id" readonly="1"/>
            </group>
          </group>
        </sheet>
      </form>
    </field>
  </record>

  <menuitem
    id="school_courses_and_classes_menuitem"
    parent="school.school_settings_menu"
    name="Courses &amp; classes"
    sequence="60"
  />

  <!-- Courses Views -->
  <act_window
    id="school_courses_action"
    name="Courses"
    res_model="school.course"
    view_mode="tree,form"
  />

  <menuitem
    id="school_courses_menuitem"
    parent="school.school_courses_and_classes_menuitem"
    name="Courses"
    sequence="60"
    action="school.school_courses_action"
  />

  <record id="school_course_view_tree" model="ir.ui.view">
    <field name="name">school.course.view.tree</field>
    <field name="model">school.course</field>
    <field name="arch" type="xml">
      <tree>
        <field name="name"/>
      </tree>
    </field>
  </record>

  <record id="school_course_view_form" model="ir.ui.view">
    <field name="name">school.course.view.form</field>
    <field name="model">school.course</field>
    <field name="arch" type="xml">
      <form>
        <field name="id" invisible="1"/>
        <sheet>
          <group>
            <group name="left_group">
              <field name="name"/>
            </group>
            <group name="right_group">
              <field name="program_ids"/>
            </group>
          </group>
          <notebook>
            <page name="classes" string="Classes">
              <field name="class_ids" mode="kanban" context="{'default_course_id': id}"/>
            </page>
            <page name="required_skills" string="Required skill">
              <field name="required_skill_ids"
                     context="{'default_res_model': 'school.course'}">
                <tree editable="bottom">
                  <field name="skill_id"/>
                  <field name="skill_type_id"/>
                  <field name="skill_level_id" domain="[('skill_type_id', '=', skill_type_id)]"/>
                  <field name="level_progress" widget="progressbar"/>
                  <field name="res_model" invisible="1" force_save="1"/>
                </tree>
              </field>
            </page>
          </notebook>
        </sheet>
      </form>
    </field>
  </record>

  <!-- Class Views -->
  <act_window
    id="school_classes_action"
    name="Classes"
    res_model="school.class"
    view_mode="tree,form"
    context="{'search_default_group_by_course_id': 1}"
  />

  <menuitem
    id="school_classes_menuitem"
    parent="school.school_courses_and_classes_menuitem"
    name="Classes"
    sequence="60"
    action="school.school_classes_action"
  />

  <record id="school_class_view_search" model="ir.ui.view">
    <field name="name">school.class.view.search</field>
    <field name="model">school.class</field>
    <field name="arch" type="xml">
      <search>
        <field name="name"/>
        <field name="period_ids"/>
        <field name="student_ids"/>

        <filter name="group_by_course_id" string="Group by course" context="{'group_by': 'course_id'}"/>

        <searchpanel>
          <field name="period_ids" select="multi" string="Periods" color="#4682b4" groupby="program_id"/>
        </searchpanel>
      </search>
    </field>
  </record>

  <record id="school_class_view_tree" model="ir.ui.view">
    <field name="name">school.class.view.tree</field>
    <field name="model">school.class</field>
    <field name="arch" type="xml">
      <tree>
        <field name="name"/>
        <field name="course_id"/>
        <field name="linked_class_ids" widget="many2many_tags" optional="hide"/>
        <field name="period_ids" widget="many2many_tags" optional="hide"/>
      </tree>
    </field>
  </record>

  <record id="school_class_view_form" model="ir.ui.view">
    <field name="name">school.class.view.form</field>
    <field name="model">school.class</field>
    <field name="arch" type="xml">
      <form>
        <sheet>
          <div class="oe_title">
            <label for="name" class="oe_edit_only"/>
            <h1>
              <field name="name"/>
            </h1>
          </div>
          <div class="oe_subtitle">
            <label for="description" class="oe_edit_only"/>
            <field name="description" placeholder="description"/>
          </div>
          <group>
            <group name="left_group">
              <field name="linked_class_ids" widget="many2many_tags"/>
            </group>
            <group name="right_group">
              <field name="course_id"/>
              <field name="program_ids" widget="many2many_tags"/>
            </group>
          </group>
          <notebook>
            <page name="required_skills" string="Required skill">
              <field name="required_skill_ids"
                     context="{'default_res_model': 'school.class'}">
                <tree editable="bottom">
                  <field name="skill_id"/>
                  <field name="skill_type_id"/>
                  <field name="skill_level_id" domain="[('skill_type_id', '=', skill_type_id)]"/>
                  <field name="level_progress" widget="progressbar"/>
                  <field name="res_model" invisible="1" force_save="1"/>
                </tree>
              </field>
            </page>
            <page name="periods" string="Periods">
              <field name="period_relation_ids"
                     context="{'default_class_program_ids': program_ids, 'default_class_id': id}">
                <tree editable="bottom">
                  <field name="class_id" invisible="1"/>
                  <field name="class_program_ids" invisible="1"/>
                  <field name="other_program_ids" invisible="1"/>
                  <field name="program_id"
                         domain="[('id', 'in', class_program_ids), ('id', 'not in', other_program_ids)]"/>
                  <field name="period_category_id"/>
                  <field
                    name="period_ids"
                    domain="[('category_id', '=', period_category_id), ('program_id', '=', program_id)]"
                    widget="many2many_tags"/>
                </tree>
              </field>
            </page>
            <page name="students" string="Students">
              <field name="student_ids" mode="kanban"/>
            </page>
            <page name="employees" string="Employees">
              <field name="employee_ids" mode="kanban"/>
            </page>
          </notebook>
        </sheet>
      </form>
    </field>
  </record>

</odoo>
